<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JS Web APIs</title>
  </head>
  <body>
    <h2>API</h2>
    <p>
      API is a set of rules and tools that allows different software applications or systems to communicate with each
      other.
    </p>
    <p>
      An API (Application Programming Interface) is a bridge that allows two software applications or systems to
      communicate with each other.
    </p>
    <p>APIs can be used to send data, retrieve data, or trigger actions in another application.</p>
    <p>Example of API in Real Lifeis >> The waiter (API) connects you (client) with the kitchen (server).</p>
    <p>
      <b>Web APIs → </b> is used to communicate over the internet. Example: Fetching weather data from an API like
      OpenWeatherMap.
    </p>
    <p>
      A Web API is an API that allows communication between a client (frontend) and a server (backend) over the
      internet.
    </p>
    <!-- Example of a Web API Request (Using JavaScript Fetch)
Fetching data from a REST (Representational State Transfer) API: -->
    <script>
      fetch("https://jsonplaceholder.typicode.com/posts/3") // API request
        .then((response) => response.json()) // Convert response to JSON
        .then((data) => console.log(data)) // Print API response
        .catch((error) => console.error("Error:", error));
    </script>

    <h2>Third Party APIs</h2>
    <p>Third party APIs are not built into your browser.</p>
    <p>To use these APIs, you will have to download the code from the Web.</p>
    <pre>
        YouTube API - Allows you to display videos on a web site.
        Twitter API - Allows you to display Tweets on a web site.
        Facebook API - Allows you to display Facebook info on a web site.
    </pre>

    <br />
    <br />
    <h2>Web History API</h2>
    <p>The Web History API provides easy methods to access the windows.history object.</p>
    <p>The window.history object contains the URLs (Web Sites) visited by the user.</p>

    <h2>History Object Properties/Methods</h2>
    <p><b>length property</b> Returns the number of URLs in the history list</p>
    <p>
      back() method Loads the previous URL in the history list. forward() method Loads the next URL in the history list.
      go() method Loads a specific URL from the history list.
    </p>
    <h4>History back() Method</h4>
    <p>
      The back() method loads the previous URL in the windows.history list. It is the same as clicking the "back arrow"
      in your browser.
    </p>
    <button onclick="backFun()">Go Back</button>
    <button onclick="goBackFun()">Go Back 2 Pages</button>
    <script>
      function backFun() {
        window.history.back();
      }

      function goFun() {
        window.history.go(-2);
      }
    </script>

    <br />
    <br />
    <h2>Web Storage API</h2>
    <p>The Web Storage API is a simple syntax for storing and retrieving data in the browser.</p>
    <!-- Example below -->
    <script>
      localStorage.setItem("name", "Khalid Usman");
      document.write(localStorage.getItem("name"));
    </script>
    <h3>The localStorage Object</h3>
    <p>
      The localStorage object provides access to a local storage for a particular Web Site. It allows you to store,
      read, add, modify, and delete data items for that domain.
    </p>
    <p>
      The data is stored with no expiration date, and will not be deleted when the browser is closed. The data will be
      available for days, weeks, and years.
    </p>
    <h3>The setItem() Method</h3>
    <p>The localStorage.setItem() method stores a data item in a storage. It takes a name and a value as parameters:</p>

    <h3>The getItem() Method</h3>
    <p>The localStorage.getItem() method retrieves a data item from the storage. It takes a name as parameter:</p>

    <h3>The sessionStorage Object</h3>
    <p>
      The sessionStorage object is identical to the localStorage object. The difference is that the sessionStorage
      object stores data for one session. The data is deleted when the browser is closed.
    </p>
    <h2>Storage Object Properties and Methods</h2>
    <p>key(n)... Returns the name of the nth key in the storage</p>
    <p>removeItem(keyname)... Removes that key from the storage</p>
    <p>clear().... Empty all key out of the storage</p>

    <!-- Property	                 Description
window.localStorage	    Allows to save key/value pairs in a web browser. Stores the data with no expiration date
window.sessionStorage	Allows to save key/value pairs in a web browser. Stores the data for one session -->

    <h2>Web Workers API</h2>
    <p>A web worker is a JavaScript file running in the background, without affecting the performance of the page.</p>
    <p>When executing scripts in an HTML page, the page becomes unresponsive until the script is finished.</p>
    <p>
      A web worker is a JavaScript that runs in the background, independently of other scripts, without affecting the
      performance of the page. You can continue to do whatever you want: clicking, selecting things, etc., while the web
      worker runs in the background.
    </p>
    <p>
      The Web Worker API allows JavaScript to run in the background, enabling multi-threading to prevent UI blocking.
    </p>
    <h2>Web Worker API Demo</h2>
    <button onclick="startWorker()">Start Heavy Task</button>
    <p id="result">Waiting for result...</p>

    <script>
      // let worker = new Worker("jsWebWorker.js");
      // worker.postMessage(20000000000); // PostMessage is used for sending the data
      // worker.onmessage = function (message) {
      //   // The onmessage is used for receiving the data
      //   document.write("Sum is " + message.data);
      // };

      let worker;

      function startWorker() {
        if (window.Worker) {
          //The condition if (window.Worker) checks whether the browser supports Web Workers before attempting to create one. window.Worker → A built-in JavaScript property that exists only if the browser supports Web Workers.

          if (!worker) {
            // Create worker only if it does not exist
            worker = new Worker("jsWebWorker.js"); // Load the Web Worker

            worker.onmessage = function (event) {
              //Receives the result from the worker (using postMessage from jsWebWorker.js).Updates the UI with the result.
              //We use onmessage in both files because Web Workers communicate using messages.
              document.getElementById("result").innerText = event.data; // Display result
            };

            worker.postMessage("Start"); // // postMessage is used to send data to and from a Web Worker, depending on where you call it. .. The main JavaScript file (jsWebAPIs.html) sends data to the Web Worker (jsWebWorker.js) using worker.postMessage(data).
          }
        } else {
          alert("Your browser doesn't support Web Workers.");
        }
      }
    </script>

    <h2>Fetch API</h2>
    <p>The Fetch API interface allows web browser to make HTTP requests to web servers.</p>
    <p>
      The Fetch API is used to make HTTP requests (GET, POST, PUT, DELETE, etc.) to servers, typically to fetch or send
      data.
    </p>

    <script>
      fetch("https://jsonplaceholder.typicode.com/posts/1")
        .then((response) => response.json())
        .then((data) => console.log(data))
        .catch((error) => console.error("Error:", error));

      fetch("jsWebWorker.js") // fetching data from another file
        .then((response) => {
          console.log(response.status);
          console.log(response.ok);
          return response.text();
        })
        .then((data) => {
          console.log(data);
        })
        .catch((error) => {
          console.error("Error:", error);
        });
    </script>
    <p>
      In JavaScript's Fetch API, we often use two .then() methods because fetching data and processing it are two
      separate asynchronous steps.
    </p>
    <p>
      First .then(response => response.json()) The fetch() function returns a Promise that resolves to a Response
      object.However, this Response object does not contain the actual data yet.We need to extract the JSON body using
      .json(), which returns another Promise..then(response => response.json()) This converts the raw HTTP response into
      usable JSON data.
    </p>
    <p>
      Second .then(data => console.log(data)) The .json() method also returns a Promise because converting the response
      body to JSON is an asynchronous operation. This means we need another .then() to handle the actual JSON
      data..then(data => console.log(data)). This handles the actual parsed JSON data and logs it to the console.
    </p>
    <script>
      fetch("https://jsonplaceholder.typicode.com/posts/1")
        .then((response) => console.log(response)) // ❌ This logs the response object, not data
        .catch((error) => console.error("Error:", error));
    </script>
    <h2>Alternative: Using async/await Instead of .then()</h2>
    <p>Instead of chaining .then(), we can use async/await, which makes the code more readable:</p>
    <script>
      async function fetchData() {
        try {
          let response = await fetch("https://jsonplaceholder.typicode.com/posts/1");
          let data = await response.json(); // Process JSON
          console.log(data); // Use the data
        } catch (error) {
          console.error("Error:", error);
        }
      }

      fetchData();
    </script>

    <h2>Web Geolocation API</h2>
    <p>The HTML Geolocation API is used to get the geographical position of a user.</p>
    <p>Since this can compromise privacy, the position is not available unless the user approves it.</p>
    <p>
      <b>Note that</b>The Geolocation API will only work on secure contexts such as HTTPS. If your site is hosted on a
      non-secure origin (such as HTTP) the requests to get the users location will no longer function.
    </p>

    <h2>Using the Geolocation API</h2>
    <p>The getCurrentPosition() method is used to return the user's position.</p>
    <p>The example below returns the latitude and longitude of the user's position:</p>

    <p>Click the button to get your coordinates.</p>

    <button onclick="getLocation()">Get Location</button>

    <p id="demo">Hello</p>

    <script>
      const x = document.getElementById("demo");

      function getLocation() {
        if (navigator.geolocation) {
          // In JavaScript, when we write an if statement without comparison operators (==, ===, etc.), the condition is automatically checked for truthiness or falsiness.
          navigator.geolocation.getCurrentPosition(showPosition);
        } else {
          x.innerHTML = "Geolocation is not supported by this browser.";
        }
      }

      function showPosition(position) {
        x.innerHTML = "Latitude: " + position.coords.latitude + "<br>Longitude: " + position.coords.longitude;
      }
    </script>
    <p>
      In JavaScript, when we write an if statement without comparison operators (==, ===, etc.), the condition is
      automatically checked for truthiness or falsiness.
    </p>
    <p>
      If navigator.geolocation exists (i.e., it is defined and not undefined), the condition is true, and the code
      inside the if block runs. If navigator.geolocation doesn't exist (i.e., it is undefined in older browsers that
      don't support geolocation), the condition is false, and the else block runs.
    </p>
    <h2>What is coords.latitude?</h2>
    <p>The coords object stands for coordinates and contains information about the user's location.</p>
    <p>
      In the Geolocation API, when we get the user's current location using navigator.geolocation.getCurrentPosition(),
      it returns a position object.
    </p>
    <p>
      When getCurrentPosition() runs successfully, it provides a position object, which contains a coords (coordinates)
      object.
    </p>

    <!-- Explanation of coords (Coordinates)
The coords object contains several properties related to the user's location:

latitude → The latitude of the user's position (e.g., 37.7749 for San Francisco).
longitude → The longitude of the user's position (e.g., -122.4194).
altitude → The altitude (height) in meters (may be null if not available).
accuracy → The accuracy level of the latitude/longitude in meters.
altitudeAccuracy → Accuracy of the altitude in meters.
heading → The direction the user is moving in degrees (0° = North).
speed → The user's speed in meters per second. -->
    <br /><br />
  </body>
</html>
